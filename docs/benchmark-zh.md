# benchmark

[English](./benchmark.md)

## Platform

Mac mini (2018)

- OS: macOS 11.5.1 (20G80)
- CPU: 3.2GHz 6-core Intel Core i7

客户端和服务端在同一台机器

## Test Cmd

```shell
redis-benchmark -t set,get,rpush,lpop,lrange,hset -n 1000000 -r 100000 -c 1000 --threads 4 --csv
```

## Result

看起来差距不大，但是有几个需要注意的点：

1. 测试 `rudis` 的时候，`rudis` 的 cpu 利用率 峰值大约 330%, `redis-benchmark` 几乎 400%. 也就是压测工具跑满了, `rudis` 还没跑满, 其实没压到 rudis 的瓶颈。
1. 测试 `redis` 的时候，`redis` 的 cpu 利用率 峰值大约 400%, `redis-benchmark` 大约 300% . 也就是压测工具没跑满了, `redis` 跑满了。
1. 不过即使是这样，`rudis` 的性能表现还是比 `redis` 要好。
1. 如果有条件，把 `redis-benchmark` 放在另一台机器上，`rudis` 应该可以跑出更好的数据。
1. 如果有条件，用更多的线程，`rudis` 的性能大概率会更好。但是 `redis` 受限于 io, 性能基本上就这样了。

### rudis

| test                               | rps       | avg_latency_ms | min_latency_ms | p50_latency_ms | p95_latency_ms | p99_latency_ms | max_latency_ms |
| ---------------------------------- | --------- | -------------- | -------------- | -------------- | -------------- | -------------- | -------------- |
| SET                                | 221385.86 | 3.337          | 0.640          | 3.239          | 4.863          | 5.991          | 10.647         |
| GET                                | 209731.53 | 3.305          | 0.768          | 3.207          | 4.895          | 5.927          | 7.095          |
| RPUSH                              | 209731.53 | 3.510          | 0.752          | 3.399          | 5.191          | 6.071          | 7.911          |
| LPOP                               | 199084.22 | 3.625          | 1.312          | 3.487          | 5.375          | 6.023          | 25.295         |
| HSET                               | 199322.30 | 3.682          | 0.080          | 3.567          | 5.311          | 5.975          | 29.375         |
| LPUSH (needed to benchmark LRANGE) | 199282.58 | 3.615          | 0.376          | 3.471          | 5.407          | 6.119          | 28.863         |
| LRANGE_100 (first 100 elements)    | 77405.38  | 6.483          | 2.328          | 6.319          | 7.951          | 8.423          | 148.479        |
| LRANGE_300 (first 300 elements)    | 33698.40  | 14.912         | 1.568          | 14.503         | 19.375         | 22.335         | 145.279        |
| LRANGE_500 (first 500 elements)    | 23674.24  | 21.017         | 1.704          | 20.687         | 26.559         | 28.495         | 110.335        |
| LRANGE_600 (first 600 elements)    | 20083.14  | 24.772         | 1.536          | 24.527         | 31.135         | 33.119         | 124.287        |

### redis 6.2.5

| test                               | rps       | avg_latency_ms | min_latency_ms | p50_latency_ms | p95_latency_ms | p99_latency_ms | max_latency_ms |
| ---------------------------------- | --------- | -------------- | -------------- | -------------- | -------------- | -------------- | -------------- |
| SET                                | 159744.41 | 5.363          | 1.880          | 5.455          | 7.367          | 8.879          | 26.751         |
| GET                                | 166417.05 | 5.012          | 1.808          | 5.239          | 6.511          | 7.247          | 29.199         |
| RPUSH                              | 166334.00 | 5.171          | 1.856          | 5.399          | 6.703          | 7.559          | 25.647         |
| LPOP                               | 159693.39 | 5.256          | 1.952          | 5.455          | 6.927          | 7.631          | 28.495         |
| HSET                               | 147907.11 | 5.612          | 2.120          | 5.823          | 7.279          | 8.031          | 35.967         |
| LPUSH (needed to benchmark LRANGE) | 153562.66 | 5.490          | 1.968          | 5.567          | 7.231          | 8.343          | 130.111        |
| LRANGE_100 (first 100 elements)    | 61282.02  | 13.901         | 2.632          | 13.911         | 17.103         | 18.527         | 139.007        |
| LRANGE_300 (first 300 elements)    | 29683.28  | 24.178         | 1.448          | 23.791         | 35.807         | 42.047         | 144.255        |
| LRANGE_500 (first 500 elements)    | 19749.96  | 35.496         | 1.424          | 35.167         | 53.695         | 62.303         | 129.215        |
| LRANGE_600 (first 600 elements)    | 16997.84  | 40.824         | 1.384          | 40.607         | 62.079         | 71.103         | 128.895        |
